

<script type="text/javascript">

    RED.nodes.registerType('msbot-offline',{
        category: 'üñêÔ∏è_channels_helpers',
        color: '#8accff',
        defaults:  { 
            name:   { value: undefined },
            webchat:  { value: "/offchat", validate: function(v) {
                return (v.match(/^\/.+/ig)) }
            },
            endpoint:   { value: "/api/v1/messages", validate: function(v) {
                return (v.match(/^\/.+/ig)) }
            },
            express:    { value: "http://127.0.0.1:3000" },
            host:       { value: "http://127.0.0.1:1880" },
            start:  { value: "geststarted" },
            title:  { value: undefined },
            icon:   { value: undefined },
            css:    { value: undefined }
        },
        inputs:0,
        outputs:0,
        icon: "azure.png", 
        align: "left",
        paletteLabel: "Offline",
        oneditprepare: function(){ 
            $("#node-input-host").typedInput({     default: 'str', types: ['str'], type: 'str' });
            $("#node-input-webchat").typedInput({  default: 'str', types: ['str'], type: 'str' });
            $("#node-input-express").typedInput({  default: 'str', types: ['str'], type: 'str' });
            $("#node-input-endpoint").typedInput({ default: 'str', types: ['str'], type: 'str' });

            $("#node-input-bot").typedInput({    default: 'str', types: ['str'], type: 'str' });
            $("#node-input-secret").typedInput({ default: 'str', types: ['str'], type: 'str' });

            $("#node-input-start").typedInput({  default: 'str', types: ['str'], type: 'str' });
            $("#node-input-title").typedInput({  default: 'str', types: ['str'], type: 'str' });
            $("#node-input-icon").typedInput({   default: 'str', types: ['str'], type: 'str' });
            $("#node-input-css").typedInput({    default: 'str', types: ['str'], type: 'str' });
        },
        label: function() { return this.name || "DirectLine offline"; }

    });

</script>

<script type="text/x-red" data-template-name="msbot-offline">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <br>
    <b>URL</b>
    <div class="form-row">
        <br>
        <label for="node-input-host"><i class="fa fa-globe"></i> Host</label>
        <input type="text" id="node-input-host" placeholder="http://127.0.0.1:1880" style="width:70%;">
    </div>
    <div class="form-row">
        <label for="node-input-express"><i class="fa fa-globe"></i> Express</label>
        <input type="text" id="node-input-express" placeholder="http://127.0.0.1:3000" style="width:70%;">
    </div>

    <br>
    <b>DirectLine routes and settings </b>
    <div class="form-row">
        <br>
        <label for="node-input-webchat"><i class="fa fa-globe"></i> Webchat</label>
        <input type="text" id="node-input-webchat" placeholder="/webchat" style="width:70%;">
    </div>
    <div class="form-row">
        <label for="node-input-endpoint"><i class="fa fa-globe"></i> Endpoint</label>
        <input type="text" id="node-input-endpoint" placeholder="/api/v1/messages" style="width:70%;">
    </div>
    <div class="form-row">
        <label for="node-input-start"><i class="fa fa-sign-in"></i> Start</label>
        <input type="text" id="node-input-start" placeholder="getstarted" style="width:70%;">
    </div>

    <br>
    <b>Page settings </b>
    <div class="form-row">
        <br>
        <label for="node-input-title"><i class="fa fa-tag"></i> Title</label>
        <input type="text" id="node-input-title" placeholder="My bot" style="width:70%;">
    </div>
    <div class="form-row">
        <label for="node-input-css"><i class="fa fa-font"></i> CSS</label>
        <input type="text" id="node-input-css" placeholder="" style="width:70%;">
    </div>

</script>

<script type="text/x-red" data-help-name="msbot-offline">
    <p>Uses a botbuilder node to connect offline. </p>

    <h3>Details</h3>
    <p>Caution: this can only be used to test your chatbot without any Internet connexion or locally. Please do not create multiple conversations.</p>
    <p>Properties</p>
    <dl class="message-properties">
        <dt>Host <span class="property-type">string</span></dt>
        <dd>the host URL (Node-RED) for callbacks</dd>
        <dt>Express <span class="property-type">string</span></dt>
        <dd>the endpoint/port to host the offline connector</dd>
        <dt>Webchat <span class="property-type">string</span></dt>
        <dd>the route to access the webchat. Note that /yourRoute/lib will also be used</dd>
        <dt>Endpoint <span class="property-type">string</span></dt>
        <dd>the bot messaging endpoint (generally ends in api/v1/messages)</dd>
        <dt>Start <span class="property-type">string</span></dt>
        <dd>the message to send in the flow when a conversation window is open</dd>
        <dt>Title <span class="property-type">string</span></dt>
        <dd>the botchat window title</dd>
        <dt>CSS <span class="property-type">string</span></dt>
        <dd>a CSS sheet to replace the actual style</dd>
    </dl>

    <h3>References</h3>
    <ul>
        <li><a href="https://github.com/ryanvolum/offline_dl">Offline Directline</a> - the github repository</li>
        <li><a href="https://github.com/NGRP/node-red-contrib-viseo/">VISEO BotMaker</a> - the nodes github repository</li>
    </ul>

</script>
