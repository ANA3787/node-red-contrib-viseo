<script type="text/javascript">
    RED.nodes.registerType('attachement',{
        category: 'VISEO_BOT',
        color: '#3FADB5',
        defaults:  { 
            name		: { value: undefined },
	    	afterPrompt : { value: false },
            path		: { value: "" },
	    	output		: { value: "" }
        },
        inputs:  1,
        outputs: 4,
        icon: "store.svg",  align: "left",
		paletteLabel: "Attachment",
        label: function() { return this.name || "Attachment"; }
    });
</script>

<script type="text/x-red" data-template-name="attachement">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="icon-tag"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="{working directory}/files">
    </div>
    <div class="form-row">
        <label for="node-input-output"><i class="icon-tag"></i> Output</label>
        <input type="text" id="node-input-output" placeholder="attachments">
    </div>
    <div class="form-row">
        <label for="node-input-afterPrompt"><i class="icon-tag"></i> AfterPrompt</label>
        <input type="checkbox" style="width: auto;" id="node-input-afterPrompt"> <span style="font-size: 12px">
	After a prompt</span>
    </div>
</script>

<script type="text/x-red" data-help-name="attachement">
	<h1>Download Attachments</h1>

	<h2>Description</h2>

	<p>This node downloads the files in attachments, sent by the client. It saves them and add the attachments 
	array which describe the file(s) downloaded. This component support text and binary file.

	<p><b><i>attachments</i> is an array of attachment:</b><br>
		<li><b>contentType</b> : the type of the file.
		<li><b>length</b> : the length of the file.
		<li><b>file</b> : the absolute path name of the file.
    	</p>

	<h2>Parameters</h2>
	<p>
	<ol>
		<li><b>Name :</b> used to override the default name of this node.
		<li><b>Path :</b> must be set with the directory path where the downloaded files will be stored. 
		May not support Windows. Default value is the subdirectory "files" of the current working 
		directory.
		<li><b>Output :</b> can be used to set the property name where the attachments array will be stored.
		the default value is <i>attachments</i>.
		<li><b>AfterPrompt :</b> useful if you are waiting for a file after a prompt message 
		sent to the user.
	</ol>
	<i><b>*</b> for mandatory parameters</i>
	</p>	

	<h3>Outputs</h3>
	<p>
	<ol>
		<li>There is at least one image downloaded.
		<li>There is no image donwloaded but at least an audio one.
		<li>no image and no audio downloaded... but there is something...
		<li>There is no attachment sent by the client, or if an error is raised
	</ol>
	</p>	

	<h3>Notes</h3>    
    	
	<p><b>Skype:</b> this node support download from skype. Becareful, if a client uses skype to send more than one
	file, that will generate a different call to the node-red flow for each of them.</p>

    	<p><b>WebChat:</b> ok, clients are not allowed to upload more than one file.</p>

	<p><b>Messenger:</b> ???
	</p>

	<p><b>Telegram:</b> ok with one file uploaded by the client. More test required.
	</p>
</script>
