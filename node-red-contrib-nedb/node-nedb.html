<script type="text/javascript">
    RED.nodes.registerType('nedb',{
        category: 'VISEO_DB',
        color: '#3FADB5',
        defaults: { 
            name:      { value: undefined },
            path:      { value: undefined },
            xlsx:      { value: undefined },
            key: 	   { value: undefined },
            value:     { value: undefined },
            operation: { value: undefined },
            merge:     { value: undefined }
        },
        inputs:  1,
        outputs: 1,
        icon: "db.svg",
        align: "left",
        paletteLabel: "NeDB",
        label: function() { return this.name || "NeDB"; }
    });
</script>

<script type="text/x-red" data-template-name="nedb">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <h4 style="border-bottom: 1px solid #AAA; margin: 1em 0em 1em 0em;">Config</h4>
    <div class="form-row">
        <label for="node-input-path"><i class="icon-tag"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="{cwd}/data/database.db">
    </div>
    <div class="form-row">
        <label for="node-input-xlsx"><i class="icon-tag"></i> XLSX Tab</label>
        <input type="text" id="node-input-xlsx" placeholder="">
        <div style="padding-left: 104px;"><em>For XLSX Path import tab to NeDB readonly</em></div>
    </div>

    <h4 style="border-bottom: 1px solid #AAA; margin: 1em 0em 1em 0em;">Query</h4>
    <div class="form-row">
        <label for="node-input-key"><i class="icon-tag"></i> Key</label>
        <input type="text" id="node-input-key" placeholder="payload">
    </div>
    <div class="form-row">
        <label for="node-input-value"><i class="icon-tag"></i> Value</label>
        <input type="text" id="node-input-value" placeholder="payload">
    </div>
    <div class="form-row">
        <label for="node-input-operation"><i class="icon-tag"></i> Operation</label>
        <select id="node-input-operation" style="width:125px">
            <option value="set">set</option>
            <option value="get">get</option>
            <option value="find">find</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-merge"></label>
        <input type="checkbox" style="width: auto;" id="node-input-merge"> <span style="font-size: 12px">(merge GET with existing property)</span>
    </div>
</script>

<script type="text/x-red" data-help-name="nedb">
    Retrieve or Save an object of the data flow according to a data flow id.
    For instance, to retrieve or save a data.user then set key=data.user.id and value=data.user 
    For a get, if the user already exists in the flow then it is merged with new one  
    <h2>Fields</h2>
    <ul>
        <li><b>Name:</b> can be used to override the default name of the node.</li>
        <li><b>Key:</b> filled with the property used as the key (mandatory). </li>
        <li><b>Value:</b> filled with the property used as the value (mandatory).</li>
        <li><b>Operation:</b> <i>set</i> is used to store the value. <i>get</i> is used to 
        fetch the value according to a given id. <i>find</i> query database with JSON key</li>
    </ul>
</script>